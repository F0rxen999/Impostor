<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8">
<title>IMPOSTOR FINAL</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#0f172a">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800;900&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #6366f1;
    --primary-glow: rgba(99, 102, 241, 0.5);
    --accent: #06b6d4;
    --impostor: #ff3b30;
    --impostor-glow: rgba(255, 59, 48, 0.5);
    --text: #ffffff;
    --text-dim: #94a3b8;
    --glass: rgba(15, 23, 42, 0.65);
    --glass-border: rgba(255, 255, 255, 0.1);
  }

  * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
  
  body {
    font-family: 'Outfit', sans-serif;
    background: #0f172a;
    color: var(--text);
    height: 100dvh;
    overflow: hidden;
    position: relative;
  }

  /* T≈ÅO */
  .bg-mesh {
    position: fixed; inset: -50%;
    background: radial-gradient(circle at 50% 50%, rgba(99,102,241,0.15), transparent 60%),
                radial-gradient(circle at 80% 20%, rgba(6,182,212,0.15), transparent 50%),
                radial-gradient(circle at 20% 80%, rgba(239,68,68,0.1), transparent 50%);
    animation: meshMove 20s infinite alternate linear;
    z-index: -1;
  }
  @keyframes meshMove {
    0% { transform: rotate(0deg) scale(1); }
    100% { transform: rotate(10deg) scale(1.1); }
  }

  .hidden { display: none !important; }
  
  .container {
    height: 100%; display: flex; flex-direction: column; 
    padding: env(safe-area-inset-top) 24px calc(20px + env(safe-area-inset-bottom)) 24px;
    width: 100%; max-width: 500px; margin: 0 auto; overflow-y: auto;
    position: relative; z-index: 1; scrollbar-width: none;
  }
  .container::-webkit-scrollbar { display: none; }

  .fade-in { animation: enterScreen 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); }
  @keyframes enterScreen { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

  h1 { 
    font-size: 42px; font-weight: 900; margin-bottom: 4px; letter-spacing: -1.5px; line-height: 1;
    background: linear-gradient(to right, #fff, #cbd5e1); -webkit-background-clip: text; color: transparent;
  }
  .sub-title { font-size: 13px; color: var(--accent); font-weight: 700; letter-spacing: 2px; margin-bottom: 30px; text-transform: uppercase; }
  label { font-size: 11px; color: var(--text-dim); text-transform: uppercase; font-weight: 700; letter-spacing: 1px; display:block; margin-bottom: 10px; margin-top: 24px; }

  .glass-panel {
    background: var(--glass); backdrop-filter: blur(16px);
    border: 1px solid var(--glass-border); border-radius: 20px;
  }

  .btn {
    width: 100%; padding: 20px; border-radius: 18px; border: none;
    font-size: 18px; font-weight: 800; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px;
  }
  .btn:active { transform: scale(0.97); }
  .primary { background: var(--primary); color: white; box-shadow: 0 8px 30px var(--primary-glow); }
  .danger { background: var(--impostor); color: white; box-shadow: 0 8px 30px var(--impostor-glow); }
  .secondary { background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.1); }
  .outline { background: transparent; border: 2px solid rgba(255,255,255,0.2); color: var(--text-dim); }

  .input-row {
    background: rgba(0,0,0,0.3); border-radius: 14px; padding: 6px 16px;
    display: flex; align-items: center; margin-bottom: 10px;
    border: 1px solid var(--glass-border); transition: 0.2s;
  }
  .input-row:focus-within { border-color: var(--primary); background: rgba(0,0,0,0.5); }
  .input-row input { background: transparent; border: none; color: white; font-size: 16px; padding: 12px 0; flex: 1; outline: none; font-weight: 600; font-family: inherit; }
  .del-btn { color: var(--impostor); font-weight: 900; padding: 10px; cursor: pointer; opacity: 0.8; }
  .add-btn {
    background: rgba(255,255,255,0.03); border: 2px dashed rgba(255,255,255,0.1); color: var(--text-dim);
    padding: 14px; border-radius: 14px; text-align: center; font-weight: 700; cursor: pointer; margin-bottom: 10px;
  }

  .cat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 30px; }
  .cat-item {
    background: rgba(30, 41, 59, 0.6); padding: 18px; border-radius: 16px;
    border: 2px solid transparent; cursor: pointer; text-align: center; transition: 0.2s;
  }
  .cat-item.active { border-color: var(--accent); background: rgba(6, 182, 212, 0.15); color: white; box-shadow: 0 0 20px rgba(6, 182, 212, 0.2); }
  .cat-item.hardcore.active { border-color: var(--impostor); background: rgba(239,68,68,0.2); }
  .cat-item.rap.active { border-color: #a855f7; background: rgba(168, 85, 247, 0.2); }
  .cat-name { font-weight: 800; font-size: 13px; }
  .cat-count { font-size: 10px; color: var(--text-dim); margin-top: 4px; font-weight: 600; }
  
  .cat-item.hardcore { border-color: rgba(239,68,68,0.3); }
  .cat-item.hardcore .cat-name { color: #fca5a5; }
  .cat-item.rap { border-color: rgba(168, 85, 247, 0.3); }
  .cat-item.rap .cat-name { color: #d8b4fe; }

  .scene { width: 100%; height: 50vh; min-height: 380px; perspective: 1200px; margin: 20px 0 30px 0; cursor: pointer; }
  .card { width: 100%; height: 100%; position: relative; transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform-style: preserve-3d; }
  .card.flipped { transform: rotateY(180deg); }
  .face {
    position: absolute; inset: 0; backface-visibility: hidden; border-radius: 32px;
    display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 25px;
    box-shadow: 0 30px 60px -12px rgba(0,0,0,0.8); border: 1px solid rgba(255,255,255,0.1);
    background: linear-gradient(145deg, #1e293b, #0f172a);
  }
  .back { background: #020617; transform: rotateY(180deg); border: 2px solid var(--accent); }
  .back.is-impostor { border-color: var(--impostor); background: radial-gradient(circle at center, #450a0a 0%, #000 100%); }
  .back.reveal-mode { border-color: #fbbf24; background: radial-gradient(circle at center, #422006 0%, #000 100%); }

  .avatar {
    width: 110px; height: 110px; background: linear-gradient(135deg, var(--primary), #4f46e5); 
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    font-size: 48px; font-weight: 900; margin-bottom: 24px;
    box-shadow: 0 0 40px var(--primary-glow); color: white;
  }
  .role-tag { font-size: 11px; letter-spacing: 3px; opacity: 0.7; margin-bottom: 12px; font-weight: 800; text-transform: uppercase; }
  .big-word { font-size: 40px; font-weight: 900; text-align: center; line-height: 1.1; color: white; margin-bottom: 20px; }
  .hint-container { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 18px 25px; border-radius: 18px; text-align: center; width: 100%; }
  .hint-val { font-size: 24px; font-weight: 800; color: var(--accent); }
  .is-impostor .hint-val { color: var(--impostor); }

  .timer { font-size: 110px; font-weight: 900; margin: 30px 0; text-align: center; background: linear-gradient(to bottom, #fff, #94a3b8); -webkit-background-clip: text; color: transparent; }
  
  .overlay {
    position: fixed; inset: 0; background: rgba(2, 6, 23, 0.95); backdrop-filter: blur(12px);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    z-index: 100; opacity: 0; pointer-events: none; transition: 0.3s; padding: 30px;
  }
  .overlay.show { opacity: 1; pointer-events: auto; }
  .setting-row { display: flex; justify-content: space-between; align-items: center; padding: 16px; background: rgba(30,41,59,0.6); border-radius: 16px; }
  .switch { position: relative; width: 52px; height: 30px; }
  .switch input { opacity: 0; width: 0; height: 0; }
  .slider { position: absolute; inset: 0; background: #334155; border-radius: 34px; transition: .3s; }
  .slider:before { position: absolute; content: ""; height: 22px; width: 22px; left: 4px; bottom: 4px; background: white; border-radius: 50%; transition: .3s; }
  input:checked + .slider { background: var(--primary); }
  input:checked + .slider:before { transform: translateX(22px); }
</style>
</head>
<body>

<div class="bg-mesh"></div>

<!-- MENU -->
<div id="v-menu" class="container fade-in" style="justify-content: center; text-align: center;">
  <h1>IMPOSTOR</h1>
  <div class="sub-title">by Lisek & Gemini</div>
  <div style="margin: 40px 0;">
    <div class="glass-panel" style="padding: 30px; margin-bottom: 10px; border-color: var(--accent);">
      <span style="font-size:50px">üî•</span>
      <h3 style="margin-top:15px; font-size:24px; font-weight:800; color:white;">TYSIƒÑCE S≈Å√ìW</h3>
      <p style="font-size:12px; color:var(--text-dim); margin-top:5px;">Edycja z Awatarami</p>
    </div>
  </div>
  <button class="btn primary" onclick="nav.to('v-setup')">ROZPOCZNIJ GRƒò</button>
</div>

<!-- SETUP -->
<div id="v-setup" class="container hidden fade-in">
  <h1>Konfiguracja</h1>
  <div class="sub-title" style="margin-bottom:10px">Sk≈Çad i zasady</div>
  <label>Gracze</label>
  <div id="players-list"></div>
  <div class="add-btn" onclick="game.addPlayer()">+ Dodaj gracza</div>
  <label>Kategorie</label>
  <div class="cat-grid" id="cat-grid"></div>
  <label>Zasady</label>
  <div class="setting-row">
    <span style="font-size:14px; font-weight:600">Podpowied≈∫ dla Impostera</span>
    <label class="switch"><input type="checkbox" id="opt-hint" checked><span class="slider"></span></label>
  </div>
  <div class="setting-row" style="margin-top:10px">
    <span style="font-size:14px; font-weight:600">Czas rundy (sekundy)</span>
    <input type="number" id="opt-time" value="120" style="width:70px; background:transparent; border:none; color:white; text-align:right; font-size:18px; font-weight:700;">
  </div>
  <div style="height: 30px"></div>
  <button class="btn primary" onclick="game.start()">GRAJ</button>
</div>

<!-- KARTA -->
<div id="v-card" class="container hidden fade-in" style="justify-content: center;">
  <div class="scene">
    <div class="card" id="game-card" onclick="game.flip()">
      <div class="face front">
        <div class="role-tag">RUNDA DLA</div>
        <div class="avatar" id="c-avatar">?</div>
        <h1 id="c-name" style="color:white; font-size:36px">Gracz</h1>
        <div style="margin-top:40px; font-size:12px; font-weight:800; opacity:0.6; animation:pulse 2s infinite">DOTKNIJ KARTY</div>
      </div>
      <div class="face back" id="c-back"></div>
    </div>
  </div>
  <div id="card-controls" class="hidden fade-in">
    <button class="btn secondary" id="btn-next" onclick="game.next()">PRZEKA≈ª DALEJ</button>
    <button class="btn primary hidden" id="btn-ready" onclick="game.finishDealing()">WSZYSCY GOTOWI</button>
  </div>
</div>

<!-- STARTER -->
<div id="v-starter" class="container hidden fade-in" style="text-align:center; justify-content:center;">
  <div class="role-tag" style="margin-bottom:30px">RUNDƒò ROZPOCZYNA</div>
  <h1 id="start-name" style="font-size:56px; color:var(--accent); margin-bottom:15px; text-shadow: 0 0 30px rgba(6,182,212,0.4);">NICK</h1>
  <p style="color:var(--text-dim); font-size:16px">Zadaj pierwsze pytanie.</p>
  <div style="margin-top:60px; width:100%"><button class="btn primary" onclick="game.startTimer()">START CZASU</button></div>
</div>

<!-- TIMER -->
<div id="v-timer" class="container hidden fade-in">
  <div style="margin-top:auto; text-align:center">
    <div class="role-tag">POZOSTA≈ÅY CZAS</div>
    <div class="timer" id="timer-disp">00:00</div>
    <p style="color:var(--text-dim)">Obserwuj mowƒô cia≈Ça!</p>
  </div>
  <div style="margin-top:auto; margin-bottom:40px">
    <button class="btn secondary" onclick="game.pause()">PAUZA / G≈ÅOSOWANIE</button>
  </div>
</div>

<!-- OVERLAY -->
<div id="overlay" class="overlay">
  <h1 style="color:white; margin-bottom:10px">PAUZA</h1>
  <button class="btn primary" style="width:100%; max-width:300px" onclick="game.resume()">WZN√ìW ODLICZANIE</button>
  <button class="btn danger" style="width:100%; max-width:300px" onclick="game.preReveal()">KONIEC I G≈ÅOSOWANIE</button>
</div>

<!-- REVEAL -->
<div id="v-reveal" class="container hidden fade-in" style="justify-content:center;">
  <h1 style="text-align:center; margin-bottom:10px">FINA≈Å</h1>
  <div class="scene" style="height:400px">
    <div class="card" id="reveal-card">
      <div class="face front" style="border-color: #fbbf24; background: radial-gradient(circle, #422006 0%, #020617 100%);">
        <div style="font-size:70px">?</div>
        <div style="margin-top:20px; font-weight:900; color:#fbbf24;">KTO TO?</div>
      </div>
      <div class="face back reveal-mode">
        <div class="role-tag" style="color:#fbbf24">IMPOSTEREM BY≈Å</div>
        <div id="rev-imp-name" style="font-size:48px; font-weight:900; color:white; margin:20px 0; text-shadow: 0 0 30px #fbbf24;">NICK</div>
      </div>
    </div>
  </div>
  <button class="btn primary" id="btn-do-reveal" onclick="game.doReveal()">ODKRYJ PRAWDƒò</button>
  <div id="reveal-details" class="hidden" style="width:100%; text-align:center; animation:enterScreen 0.8s">
    <div class="glass-panel" style="padding:20px; margin-bottom:20px">
      <div class="role-tag">HAS≈ÅO</div>
      <div id="rev-word" style="font-size:32px; font-weight:900; color:var(--accent)">S≈Çowo</div>
      <div id="rev-hint" style="font-size:14px; color:var(--text-dim); margin-top:8px"></div>
    </div>
    <button class="btn secondary" onclick="game.start()">GRAJ PONOWNIE</button>
    <button class="btn outline" onclick="nav.to('v-menu')">MENU</button>
  </div>
</div>

<style>@keyframes pulse { 0%,100% { opacity:0.5; transform:scale(1); } 50% { opacity:1; transform:scale(1.05); } }</style>

<script>
/* --- BAZA DANYCH --- */
const DB = {
  "Polskie Rap Hity": [
    {w:"Szklanki", h:"ü•ÉüíÉ"}, {w:"Kiss Cam", h:"üíãüé•"}, {w:"Z≈Çote Tarasy", h:"üè¨‚ú®"}, 
    {w:"Patointeligencja", h:"üè´üö¨"}, {w:"Disney", h:"üè∞üé¢"}, {w:"Ostatnia Nadzieja", h:"üôèüíî"},
    {w:"Polskie Tango", h:"üáµüá±üíÉ"}, {w:"Szampan", h:"üçæü•Ç"}, {w:"California", h:"üå¥‚òÄÔ∏è"},
    {w:"Jetlag", h:"‚úàÔ∏èüò¥"}, {w:"Lawenda", h:"ü™ªüíú"}, {w:"Dres", h:"üëïüëü"},
    {w:"BFF", h:"üëØ‚Äç‚ôÄÔ∏èüíñ"}, {w:"Taxi", h:"üöñüåÉ"}, {w:"Malibu Barbie", h:"üçπüë±‚Äç‚ôÄÔ∏è"},
    {w:"Chyba ≈ºe z TobƒÖ", h:"üíÉüï∫"}, {w:"Stan", h:"‚òÅÔ∏èüéà"}, {w:"Piƒôkny ≈õwiat", h:"üåç‚ú®"},
    {w:"Bubbletea", h:"üßã"}, {w:"100 dni do matury", h:"üéìüíØ"}, {w:"Tamagotchi", h:"üëæ"},
    {w:"Jƒôzyk cia≈Ça", h:"üëÖ"}, {w:"Candy", h:"üç¨"}, {w:"Szafir", h:"üíé"}, {w:"Molly", h:"üíä"},
    {w:"Ogrody", h:"üå≥"}, {w:"Papuga", h:"ü¶ú"}, {w:"Bigos", h:"ü•ò"}, {w:"Deszcz", h:"‚òîÔ∏è"},
    {w:"Kebab w cienkim", h:"ü•ô"}, {w:"Gelato", h:"üç¶"}, {w:"Rower", h:"üö≤"}, {w:"Pijemy za lepszy czas", h:"üçª"}
  ],
  "Polscy Raperzy": [
    {w:"Taco Hemingway", h:"WƒÖs"}, {w:"Quebonafide", h:"Egzotyka"}, {w:"Mata", h:"Patoreakcja"},
    {w:"Bedoes", h:"2115"}, {w:"Oki", h:"Je≈ºyk"}, {w:"Kizo", h:"Kawa"},
    {w:"≈ªabson", h:"≈ªabka"}, {w:"Kukon", h:"Ogrody"}, {w:"Szpaku", h:"Simba"},
    {w:"Pezet", h:"P≈Çomie≈Ñ"}, {w:"Sok√≥≈Ç", h:"Narrator"}, {w:"Paluch", h:"BOR"},
    {w:"Malik Montana", h:"Import"}, {w:"White 2115", h:"≈Åajcior"}, {w:"Sobel", h:"Impreza"},
    {w:"Young Leosia", h:"Hulanki"}, {w:"Bambi", h:"IRL"}, {w:"Otsochodzi", h:"Tarcho"},
    {w:"Gibbs", h:"Dopehouse"}, {w:"Chivas", h:"M≈Çody"}, {w:"Kaz Ba≈Çagane", h:"Stolica"},
    {w:"ReTo", h:"Klapki"}, {w:"Guzior", h:"Mefedron"}, {w:"Sarius", h:"Antihype"},
    {w:"Paktofonika", h:"Jestem Bogiem"}, {w:"Liroy", h:"Scyzoryk"}, {w:"Tede", h:"TVN"},
    {w:"O.S.T.R.", h:"Skrzypce"}, {w:"Peja", h:"Je≈ºyce"}, {w:"Popek", h:"Oczy"},
    {w:"Kabe", h:"Francja"}, {w:"Alberto", h:"Dwutakt"}, {w:"Smolasty", h:"Du≈ºe Oczy"},
    {w:"Mr. Polska", h:"Holandia"}, {w:"Fifi", h:"WWA"}, {w:"Belmondo", h:"M≈Çody G"}
  ],
  "Polski Internet": [
    {w:"Friz", h:"Ekipa"}, {w:"Wersow", h:"Sowa"}, {w:"Wardƒôga", h:"Las"}, {w:"Kononowicz", h:"Mleko"},
    {w:"Stanowski", h:"Zero"}, {w:"Boxdel", h:"W≈Çodarz"}, {w:"Fagata", h:"Plan"}, {w:"Natsu", h:"P≈Çatki"},
    {w:"Mata", h:"McDonald"}, {w:"Lewandowski", h:"Barcelona"}, {w:"Pudzian", h:"Cierpliwo≈õƒá"},
    {w:"Budda", h:"Loteria"}, {w:"Goats", h:"Projekt"}, {w:"Linkiewicz", h:"Autobus"},
    {w:"Najman", h:"Czƒôstochowa"}, {w:"Xayoo", h:"Szachy"}, {w:"Gimper", h:"Hajsownicy"},
    {w:"Japczan", h:"Gruby"}, {w:"Tromba", h:"WƒÖ≈º"}, {w:"Mlekozyniak", h:"Czapka"},
    {w:"KsiƒÖ≈ºulo", h:"Muala"}, {w:"Dymorfia", h:"Si≈Çownia"}, {w:"Young Multi", h:"Reakcja"},
    {w:"Pasut", h:"Abstrachuje"}, {w:"Dubiel", h:"Kenia"}, {w:"Blowek", h:"Minecraft"},
    {w:"Genzie", h:"Dom"}, {w:"Patec", h:"Podr√≥≈ºe"}, {w:"Lexy", h:"Chapstick"}, {w:"Mini Majk", h:"Niski"},
    {w:"Czaro", h:"Magia"}, {w:"Mandzio", h:"Gotowanie"}, {w:"Nitrozyniak", h:"BMW"},
    {w:"Rafonix", h:"Tibijka"}, {w:"Daniel Magical", h:"Kocio≈Çek"}
  ],
  "Gry Wideo": [
    {w:"Minecraft", h:"Klocki"}, {w:"GTA V", h:"Kradzie≈º"}, {w:"Fortnite", h:"Budowanie"},
    {w:"League of Legends", h:"Toksyczno≈õƒá"}, {w:"CS:GO", h:"Bomba"}, {w:"FIFA", h:"Pi≈Çka"},
    {w:"The Witcher 3", h:"Geralt"}, {w:"Cyberpunk 2077", h:"Bug"}, {w:"Sims", h:"Basen"},
    {w:"Among Us", h:"Impostor"}, {w:"Roblox", h:"Dzieci"}, {w:"Valorant", h:"Strzelanka"},
    {w:"Call of Duty", h:"Wojna"}, {w:"Mario", h:"Grzyby"}, {w:"Pokemon", h:"Pikachu"},
    {w:"Assassin's Creed", h:"Kaptur"}, {w:"God of War", h:"Synu"}, {w:"Red Dead Redemption", h:"Kowboj"},
    {w:"Tibia", h:"Expienie"}, {w:"Metin2", h:"Kowal"}, {w:"Brawl Stars", h:"Telefon"},
    {w:"Need for Speed", h:"Wy≈õcigi"}, {w:"Tomb Raider", h:"Lara"}, {w:"Resident Evil", h:"Zombie"}
  ],
  "Marki": [
    {w:"Apple", h:"Jab≈Çko"}, {w:"Nike", h:"≈Åy≈ºwa"}, {w:"Adidas", h:"Paski"}, {w:"BMW", h:"Kierunkowskaz"},
    {w:"McDonald's", h:"Burger"}, {w:"Coca-Cola", h:"Miko≈Çaj"}, {w:"Samsung", h:"Galaxy"},
    {w:"IKEA", h:"Klopsiki"}, {w:"Mercedes", h:"Gwiazda"}, {w:"Audi", h:"K√≥≈Çka"},
    {w:"Gucci", h:"Pasek"}, {w:"Tesla", h:"PrƒÖd"}, {w:"Amazon", h:"Paczka"},
    {w:"Netflix", h:"Serial"}, {w:"YouTube", h:"Subskrypcja"}, {w:"Facebook", h:"Twarz"},
    {w:"TikTok", h:"Ta≈Ñce"}, {w:"PlayStation", h:"Konsola"}, {w:"Xbox", h:"Zielony"},
    {w:"Lego", h:"B√≥l stopy"}, {w:"Biedronka", h:"Paleta"}, {w:"Lidl", h:"Tydzie≈Ñ"},
    {w:"Pepsi", h:"Konkurencja"}, {w:"Zara", h:"Ubrania"}, {w:"H&M", h:"Moda"}
  ],
  "Geografia": [
    {w:"Polska", h:"Dom"}, {w:"Warszawa", h:"Stolica"}, {w:"Krak√≥w", h:"Smok"},
    {w:"Pary≈º", h:"Wie≈ºa"}, {w:"Londyn", h:"Big Ben"}, {w:"Nowy Jork", h:"Statua"},
    {w:"Egipt", h:"Piramida"}, {w:"Japonia", h:"Sushi"}, {w:"W≈Çochy", h:"Pizza"},
    {w:"Niemcy", h:"SƒÖsiad"}, {w:"Rosja", h:"W√≥dka"}, {w:"Chiny", h:"Mur"},
    {w:"Australia", h:"Kangur"}, {w:"Brazylia", h:"Karnawa≈Ç"}, {w:"Tatry", h:"G√≥ry"},
    {w:"Ba≈Çtyk", h:"Morze"}, {w:"Wis≈Ça", h:"Rzeka"}, {w:"Sahara", h:"Piasek"},
    {w:"Mount Everest", h:"Szczyt"}, {w:"Afryka", h:"Kontynent"}, {w:"Antarktyda", h:"L√≥d"}
  ],
  "Sportowcy": [
    {w:"Lewandowski", h:"Gol"}, {w:"Messi", h:"Argentyna"}, {w:"Ronaldo", h:"Siuuu"},
    {w:"Ma≈Çysz", h:"Skoki"}, {w:"Stoch", h:"Kamil"}, {w:"Iga ≈öwiƒÖtek", h:"Tenis"},
    {w:"Pudzianowski", h:"Si≈Çacz"}, {w:"B≈Çachowicz", h:"MMA"}, {w:"Tyson", h:"Boks"},
    {w:"Jordan", h:"Kosz"}, {w:"Kubica", h:"F1"}, {w:"Zmarzlik", h:"≈ªu≈ºel"},
    {w:"Usain Bolt", h:"Bieg"}, {w:"Phelps", h:"Basen"}, {w:"Schumacher", h:"Ferrari"},
    {w:"Szczƒôsny", h:"Bramkarz"}, {w:"Gortat", h:"NBA"}, {w:"B≈Çaszczykowski", h:"Wis≈Ça"},
    {w:"Hurkacz", h:"Serwis"}, {w:"Sochan", h:"W≈Çosy"}
  ],
  "Hardcore": [
    {w:"Inflacja", h:"Dro≈ºyzna"}, {w:"Synestezja", h:"Zmys≈Çy"}, {w:"Paradoks", h:"Sprzeczno≈õƒá"},
    {w:"Altruizm", h:"Pomoc"}, {w:"Nostalgia", h:"Wspomnienie"}, {w:"Karma", h:"Powr√≥t"},
    {w:"Ego", h:"Ja"}, {w:"Metafora", h:"Przeno≈õnia"}, {w:"Ironia", h:"Los"},
    {w:"Deja vu", h:"Powt√≥rka"}, {w:"Placebo", h:"Cukier"}, {w:"Stereotyp", h:"Schemat"},
    {w:"Abstrakcja", h:"Sztuka"}, {w:"Chaos", h:"Ba≈Çagan"}, {w:"Utopia", h:"Idea"},
    {w:"Nihilizm", h:"Nic"}, {w:"Prokrastynacja", h:"Zwlekanie"}, {w:"Empatia", h:"Wsp√≥≈Çczucie"},
    {w:"Euforia", h:"Rado≈õƒá"}, {w:"Introwertyk", h:"Wnƒôtrze"}, {w:"Relatywizm", h:"Punkt widzenia"},
    {w:"Hipokryzja", h:"Fa≈Çsz"}, {w:"Melancholia", h:"Smutek"}, {w:"Sarkazm", h:"≈ªart"},
    {w:"Charyzma", h:"Urok"}, {w:"Dedukcja", h:"Sherlock"}, {w:"Intuicja", h:"Przeczucie"}
  ],
  "Filmy & Seriale": [
    {w:"Shrek", h:"Cebula"}, {w:"Titanic", h:"G√≥ra"}, {w:"Harry Potter", h:"Blizna"},
    {w:"Matrix", h:"Pigu≈Çka"}, {w:"Batman", h:"Sierota"}, {w:"Joker", h:"≈ömiech"},
    {w:"Spider-Man", h:"Ugryzienie"}, {w:"Kr√≥l Lew", h:"Sawanna"}, {w:"Kevin", h:"Z≈Çodzieje"},
    {w:"Wied≈∫min", h:"Miecze"}, {w:"James Bond", h:"007"}, {w:"Minionki", h:"Banan"},
    {w:"Star Wars", h:"Miecz"}, {w:"W≈Çadca Pier≈õcieni", h:"Pier≈õcie≈Ñ"}, {w:"Avengers", h:"Rƒôkawica"},
    {w:"Piraci z Karaib√≥w", h:"Per≈Ça"}, {w:"Szybcy i W≈õciekli", h:"Rodzina"}, {w:"Barbie", h:"R√≥≈º"},
    {w:"Oppenheimer", h:"Bomba"}, {w:"Stranger Things", h:"Nos"}, {w:"Wednesday", h:"Taniec"},
    {w:"Squid Game", h:"Lalka"}, {w:"Breaking Bad", h:"Kryszta≈Ç"}, {w:"Gra o Tron", h:"Smok"},
    {w:"Kiler", h:"Szakal"}, {w:"Ch≈Çopaki nie p≈ÇaczƒÖ", h:"Bunkier"}, {w:"Dzie≈Ñ ≈öwira", h:"Ada≈õ"},
    {w:"Dom z Papieru", h:"Maska"}, {w:"Rick i Morty", h:"Og√≥rek"}, {w:"Ojciec Chrzestny", h:"Propozycja"}
  ],
  "Miejsca": [
    {w:"Wiƒôzienie", h:"Gryps"}, {w:"Szpital", h:"NFZ"}, {w:"Ko≈õci√≥≈Ç", h:"Taca"},
    {w:"Lotnisko", h:"Odprawa"}, {w:"Pla≈ºa", h:"Parawan"}, {w:"Las", h:"Kleszcz"},
    {w:"Si≈Çownia", h:"Karnet"}, {w:"Kino", h:"Repertuar"}, {w:"Szko≈Ça", h:"Dzwonek"},
    {w:"Cmentarz", h:"Znicz"}, {w:"ZOO", h:"Klatka"}, {w:"Apteka", h:"Recepta"},
    {w:"Biblioteka", h:"Cisza"}, {w:"Basen", h:"Chlor"}, {w:"Stacja Paliw", h:"Hot-dog"},
    {w:"Poczta", h:"Awizo"}, {w:"SƒÖd", h:"Wyrok"}, {w:"Teatr", h:"Kurtyna"},
    {w:"Kasyno", h:"Ruletka"}, {w:"Burdel", h:"Czerwony"}, {w:"Cyrk", h:"Klaun"},
    {w:"Sauna", h:"Rƒôcznik"}, {w:"Fryzjer", h:"Strzy≈ºenie"}, {w:"Bar", h:"Piwo"},
    {w:"Stadion", h:"Mecz"}, {w:"Muzeum", h:"Obraz"}, {w:"Piekarnia", h:"Chleb"}
  ],
  "Przedmioty": [
    {w:"Telefon", h:"≈Åadowarka"}, {w:"Lustro", h:"Odbicie"}, {w:"Zegar", h:"Czas"},
    {w:"Portfel", h:"Grosz"}, {w:"Pilot", h:"Baterie"}, {w:"Parasol", h:"Deszcz"},
    {w:"Laptop", h:"Myszka"}, {w:"Lod√≥wka", h:"Szron"}, {w:"D≈Çugopis", h:"Wk≈Çad"},
    {w:"Papier toaletowy", h:"Rolka"}, {w:"Klucze", h:"Brelok"}, {w:"Okulary", h:"Szk≈Ça"},
    {w:"Buty", h:"Sznurowad≈Ça"}, {w:"Plecak", h:"Zamek"}, {w:"Krzes≈Ço", h:"Oparcie"},
    {w:"Widelec", h:"Zƒôby"}, {w:"Szczoteczka", h:"Pasta"}, {w:"GƒÖbka", h:"Piana"},
    {w:"Grzebie≈Ñ", h:"W≈Çosy"}, {w:"S≈Çuchawki", h:"Muzyka"}, {w:"≈Å√≥≈ºko", h:"Ko≈Çdra"},
    {w:"Dywan", h:"Pod≈Çoga"}, {w:"Lampa", h:"≈ªar√≥wka"}, {w:"Rƒôcznik", h:"Woda"},
    {w:"Myd≈Ço", h:"Kostka"}, {w:"Skarpetki", h:"Dziura"}, {w:"Czapka", h:"Zima"}
  ],
  "Jedzenie": [
    {w:"Pizza", h:"Ciasto"}, {w:"Sushi", h:"Surowe"}, {w:"Kebab", h:"Baranina"},
    {w:"Ros√≥≈Ç", h:"Niedziela"}, {w:"Schabowy", h:"Panierka"}, {w:"Lody", h:"Ga≈Çka"},
    {w:"Pierogi", h:"Farsz"}, {w:"Bigos", h:"Kapusta"}, {w:"PƒÖczek", h:"Lukier"},
    {w:"Spaghetti", h:"Nitki"}, {w:"Burger", h:"Bu≈Çka"}, {w:"Frytki", h:"Ketchup"},
    {w:"Jajecznica", h:"≈öniadanie"}, {w:"Kanapka", h:"Mas≈Ço"}, {w:"Zupa", h:"≈Åy≈ºka"},
    {w:"Czekolada", h:"Kostka"}, {w:"Tort", h:"≈öwieczka"}, {w:"Popcorn", h:"Kukurydza"},
    {w:"Og√≥rek", h:"Kiszon"}, {w:"Pomidor", h:"Czerwony"}, {w:"Chipsy", h:"Paczka"},
    {w:"Par√≥wka", h:"Miƒôso?"}, {w:"Ser", h:"Dziury"}, {w:"Chleb", h:"Sk√≥rka"},
    {w:"Jajko", h:"≈ª√≥≈Çtko"}, {w:"Mas≈Ço", h:"Smarowanie"}, {w:"Jab≈Çko", h:"Ogryzek"},
    {w:"Banan", h:"Sk√≥rka"}, {w:"Woda", h:"Kran"}
  ],
  "Zwierzƒôta": [
    {w:"Pies", h:"Smycz"}, {w:"Kot", h:"Kuweta"}, {w:"≈ªyrafa", h:"Szyja"},
    {w:"Kura", h:"Ros√≥≈Ç"}, {w:"≈öwinia", h:"Chlew"}, {w:"Pszczo≈Ça", h:"Ul"},
    {w:"Komar", h:"Krew"}, {w:"Mysz", h:"Pu≈Çapka"}, {w:"WƒÖ≈º", h:"Jad"},
    {w:"S≈Ço≈Ñ", h:"TrƒÖba"}, {w:"Rekin", h:"P≈Çetwa"}, {w:"Pingwin", h:"Fraku"},
    {w:"Ma≈Çpa", h:"Banan"}, {w:"Krowa", h:"Mleko"}, {w:"Ko≈Ñ", h:"Siod≈Ço"},
    {w:"Ryba", h:"Woda"}, {w:"PajƒÖk", h:"Sieƒá"}, {w:"Wilk", h:"Wataha"},
    {w:"Nied≈∫wied≈∫", h:"Miodek"}, {w:"Delfin", h:"Ssak"}, {w:"Motyl", h:"Kok"},
    {w:"≈ªaba", h:"Bocian"}, {w:"Lis", h:"Chytry"}, {w:"Sowa", h:"Noc"},
    {w:"Biedronka", h:"Kropki"}, {w:"≈ölimak", h:"Muszla"}, {w:"Je≈º", h:"Ig≈Çy"}
  ]
};

const nav = {
  to: (id) => {
    document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
    const el = document.getElementById(id);
    el.classList.remove('hidden');
    el.classList.remove('fade-in');
    void el.offsetWidth; 
    el.classList.add('fade-in');
  }
};

const game = {
  players: ["Pizdel", "Brzydal", "Lisek"],
  impostorHistory: {}, currentRoleData: [], wordData: null, hintOn: true, time: 120, timer: null, currIdx: 0,

  addPlayer: function() { this.players.push(""); this.renderPlayers(); },
  renderPlayers: function() {
    const el = document.getElementById('players-list');
    el.innerHTML = '';
    this.players.forEach((p, i) => {
      const div = document.createElement('div');
      div.className = 'input-row';
      div.innerHTML = `
        <span style="margin-right:10px; font-weight:800; color:var(--text-dim); font-size:12px">${i+1}.</span>
        <input type="text" value="${p}" oninput="game.players[${i}]=this.value" placeholder="Nick">
        ${this.players.length > 3 ? `<div class="del-btn" onclick="game.remPlayer(${i})">‚úï</div>` : ''}
      `;
      el.appendChild(div);
    });
  },
  remPlayer: function(i) { if(this.players.length>3){this.players.splice(i,1); this.renderPlayers();} },

  initSetup: function() {
    this.renderPlayers();
    const grid = document.getElementById('cat-grid');
    grid.innerHTML = '';
    Object.keys(DB).forEach(k => {
      const div = document.createElement('div');
      let cls = 'cat-item';
      if(k === 'Hardcore') cls += ' hardcore';
      if(k === 'Polskie Rap Hity' || k === 'Polscy Raperzy') cls += ' rap';
      div.className = cls + ' active'; 
      div.innerHTML = `<div class="cat-name">${k}</div><div class="cat-count">${DB[k].length}</div>`;
      div.onclick = () => div.classList.toggle('active');
      grid.appendChild(div);
    });
  },

  start: function() {
    const activeCats = Array.from(document.querySelectorAll('.cat-item.active')).map(e => e.querySelector('.cat-name').innerText);
    if(!activeCats.length) return alert("Wybierz kategoriƒô!");
    const pList = this.players.filter(p => p.trim());
    if(pList.length < 3) return alert("Minimum 3 graczy!");
    this.hintOn = document.getElementById('opt-hint').checked;
    this.time = parseInt(document.getElementById('opt-time').value) || 120;

    const cat = activeCats[Math.floor(Math.random() * activeCats.length)];
    const list = DB[cat];
    const wObj = list[Math.floor(Math.random() * list.length)];
    this.wordData = { ...wObj, cat: cat };

    let impIdx, safety = 0;
    do {
      impIdx = Math.floor(Math.random() * pList.length);
      const name = pList[impIdx];
      const streak = this.impostorHistory[name] || 0;
      if (streak < 2) break; 
      safety++;
    } while (safety < 20);
    pList.forEach((name, i) => {
      if (i === impIdx) this.impostorHistory[name] = (this.impostorHistory[name] || 0) + 1;
      else this.impostorHistory[name] = 0;
    });

    this.currentRoleData = pList.map((name, i) => ({ name: name, isImp: i === impIdx }));
    this.currIdx = 0;
    this.setupCard();
    nav.to('v-card');
  },

  setupCard: function() {
    const data = this.currentRoleData[this.currIdx];
    const card = document.getElementById('game-card');
    const back = document.getElementById('c-back');
    const avatarEl = document.getElementById('c-avatar');
    
    // Reset karty
    card.classList.remove('flipped');
    back.className = 'face back'; 
    
    // NAZWA
    document.getElementById('c-name').innerText = data.name;
    
    // --- LOGIKA AWATAR√ìW ---
    const nameLower = data.name.toLowerCase().trim();
    avatarEl.style.background = ''; // Reset background
    avatarEl.style.fontSize = '';   // Reset font size

    if (nameLower === 'lisek') {
        avatarEl.innerText = 'ü¶ä';
        avatarEl.style.background = 'linear-gradient(135deg, #f97316, #ea580c)'; // Orange
    } else if (nameLower === 'pizdel' || nameLower === 'dell') {
        avatarEl.innerText = 'üßü';
        avatarEl.style.background = 'linear-gradient(135deg, #84cc16, #65a30d)'; // Green
    } else if (nameLower === 'brzydal' || nameLower === 'brzydki') {
        avatarEl.innerText = 'üöñ';
        avatarEl.style.background = 'linear-gradient(135deg, #facc15, #eab308)'; // Yellow
    } else {
        avatarEl.innerText = data.name[0].toUpperCase();
        // Default gradient defined in CSS
    }
    // -----------------------

    document.getElementById('card-controls').classList.add('hidden');
    
    let html = '';
    if(data.isImp) {
      let hintText = this.wordData.h;
      let labelText = "PODPOWIED≈π";
      if (this.wordData.cat === "Polskie Rap Hity") labelText = "EMOJI HINT";
      if (!this.hintOn && this.wordData.cat !== "Polskie Rap Hity") hintText = "Brak podpowiedzi";
      html = `
        <div class="role-tag" style="color:white">TWOJA ROLA</div>
        <div class="big-word" style="color:var(--impostor); text-shadow:0 0 20px rgba(239,68,68,0.6)">IMPOSTER</div>
        <div class="hint-container is-impostor"><div class="hint-label">${labelText}</div><div class="hint-val">${hintText}</div></div>
      `;
      back.classList.add('is-impostor');
    } else {
      html = `
        <div class="role-tag">TWOJE HAS≈ÅO</div>
        <div class="big-word" style="color:var(--accent)">${this.wordData.w}</div>
        <div class="hint-container"><div class="hint-label">KATEGORIA</div><div class="hint-val" style="font-size:18px">${this.wordData.cat}</div></div>
      `;
    }
    back.innerHTML = html;
  },

  flip: function() {
    const card = document.getElementById('game-card');
    if(card.classList.contains('flipped')) return;
    card.classList.add('flipped');
    setTimeout(() => {
      document.getElementById('card-controls').classList.remove('hidden');
      const isLast = this.currIdx === this.currentRoleData.length - 1;
      if(isLast) { document.getElementById('btn-next').classList.add('hidden'); document.getElementById('btn-ready').classList.remove('hidden'); }
      else { document.getElementById('btn-next').classList.remove('hidden'); document.getElementById('btn-ready').classList.add('hidden'); }
    }, 400);
  },

  next: function() {
    const card = document.getElementById('game-card');
    const back = document.getElementById('c-back');
    card.classList.remove('flipped');
    setTimeout(() => { back.className = 'face back'; }, 150); 
    setTimeout(() => { this.currIdx++; this.setupCard(); }, 600);
  },

  finishDealing: function() {
    const startName = this.currentRoleData[Math.floor(Math.random() * this.currentRoleData.length)].name;
    document.getElementById('start-name').innerText = startName;
    nav.to('v-starter');
  },

  startTimer: function() {
    nav.to('v-timer');
    this.updateTimerDisplay(this.time);
    if(this.timer) clearInterval(this.timer);
    this.timer = setInterval(() => {
      this.time--;
      this.updateTimerDisplay(this.time);
      if(this.time <= 0) { clearInterval(this.timer); try{navigator.vibrate([500,200,500]);}catch(e){} this.preReveal(); }
    }, 1000);
  },

  updateTimerDisplay: function(t) {
    const m = Math.floor(t / 60);
    const s = t % 60;
    document.getElementById('timer-disp').innerText = `${m}:${s<10?'0':''}${s}`;
  },

  pause: function() { clearInterval(this.timer); document.getElementById('overlay').classList.add('show'); },
  resume: function() { document.getElementById('overlay').classList.remove('show'); this.startTimer(); },

  preReveal: function() {
    clearInterval(this.timer); document.getElementById('overlay').classList.remove('show');
    const card = document.getElementById('reveal-card'); card.classList.remove('flipped');
    document.getElementById('btn-do-reveal').classList.remove('hidden');
    document.getElementById('reveal-details').classList.add('hidden');
    nav.to('v-reveal');
  },

  doReveal: function() {
    const imposter = this.currentRoleData.find(p => p.isImp);
    document.getElementById('rev-imp-name').innerText = imposter.name;
    document.getElementById('rev-word').innerText = this.wordData.w;
    document.getElementById('rev-hint').innerText = "Podpowied≈∫: " + this.wordData.h;
    const card = document.getElementById('reveal-card'); card.classList.add('flipped');
    document.getElementById('btn-do-reveal').classList.add('hidden');
    setTimeout(() => { document.getElementById('reveal-details').classList.remove('hidden'); }, 800);
  }
};

game.initSetup();
</script>
</body>
</html>
